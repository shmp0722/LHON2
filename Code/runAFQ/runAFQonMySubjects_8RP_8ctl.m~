function runAFQonMySubjects_8RP_8ctl
% Run AFQ_run for these subjects
%
%% set directory
[homeDir,subDir,JMD,CRD,LHON,Ctl,RP] = Tama_subj2;

AFQdata = homeDir;

%% Make directory structure for each subject
for ii = 1:length(RP)
    sub_dirs{ii} = fullfile(AFQdata, subDir{RP(ii)},'dwi_2nd');
end

for ii = length(RP)+1:length(RP)+length(Ctl)
    sub_dirs{ii} = fullfile(AFQdata, subDir{Ctl(ii-length(RP))},'dwi_2nd');
end

% Subject grouping is a little bit funny because afq only takes two groups
% but we have 3. For now we will divide it up this way but we can do more
% later

sub_group = zeros(1,22);
sub_group(1,1:8) = ones(1,8); 
% sub_group = [1,0];

% Now create and afq structure
afq = AFQ_Create('sub_dirs', sub_dirs, 'sub_group', sub_group, 'clip2rois', 0);

%
% if you would like to use ants for normalization
% afq = AFQ_Create('sub_dirs', sub_dirs, 'sub_group', sub_group, 'clip2rois', 0,'normalization','ants');
afq.params.cutoff = [5 95];

% % To have afq overwrite the old fibers
afq = AFQ_set(afq,'overwritesegmentation');
afq = AFQ_set(afq,'overwritecleaning');

% % afq.params.cutoff=[5 95];
afq.params.outdir = ...
    fullfile(AFQdata,'RP');
afq.params.outname = 'AFQ_8RP_14Ctl_0820.mat';

%
afq.params.maxDist = 4;
afq.params.maxLen = 3;
afq.params.clip2rois = 1;

% mrtrixs
afq.params.track.lengthThreshMm = [25 250];
afq.params.track.faMaskThresh = 0.2;


% %% Run AFQ on these subjects
afq = AFQ_run(sub_dirs, sub_group, afq);
return

%%
% %% Compute tract profiles
% 
% % Difine fgName
% fgN = {'*-Rh_NOT1201_D4_L4.pdb', '*-Lh_NOT1201_D4_L4.pdb'};
% saveN = {'LOR1206_D4L4','ROR1206_D4L4'};
% roi1Name = {'Lt-LGN4.mat','Rt-LGN4.mat'};
% roi2Name = {'lh_V1_smooth3mm_NOT.mat', 'rh_V1_smooth3mm_NOT.mat'};
% 
%  
% for ii = 1:AFQ_get(afq,'numsubDir')
%     SubDir = fullfile(AFQdata,subDir{ii});
%     fgDir  = fullfile(SubDir,'/dwi_2nd/fibers/conTrack/OR_1130');
%     fiberDir = fullfile(SubDir,'/dwi_2nd/fibers');
%     for k= 1:length(fgN)
%         cd(fgDir)
%         fgF = dir(fgN{k});
%         fg = fgRead(fgF.name);
%         fg = SO_AlignFiberDirection(fg,'AP');
%         cd(fiberDir)
%         fg.name = saveN{k};
%         fgWrite(fg,[fg.name '.pdb'],'pdb')
%         
%     end
% end
% return
%% OR

fgName   = 'ROR1206_D4L4.pdb';

roi1Name= 'Rt-LGN.mat';
roi2Name = 'rh_V1_smooth3mm_NOT.mat';
afq = AFQ_AddNewFiberGroup_2(afq, fgName, roi1Name, roi2Name, 0, 1);

fgName   = 'LOR1206_D4L4.pdb';
roi1Name = 'Lt-LGN.mat';
roi2Name = 'lh_V1_smooth3mm_NOT.mat';
afq = AFQ_AddNewFiberGroup_2(afq, fgName, roi1Name, roi2Name,0, 1);


%% OCF
fgName = 'OCFV1V2Not3mm_MD4Al.pdb';

roi1Name= 'lh_V1_smooth3mm_lh_V2_smooth3mm_NOT.mat';
roi2Name = 'rh_V1_smooth3mm_rh_V2_smooth3mm_NOT.mat';

%3
afq = AFQ_AddNewFiberGroup_3(afq, fgName, roi1Name, roi2Name, 0, 1);

%% OT
fgName = 'ROTD4L4_1206.pdb';
roi1Name = 'Optic-Chiasm.mat';
roi2Name = 'Rt-LGN4.mat';
afq = AFQ_AddNewFiberGroup_4(afq, fgName, roi1Name, roi2Name, 0, 1);


fgName = 'LORD4L4_1206.pdb';
roi1Name = 'Optic-Chiasm.mat';
roi2Name = 'Lt-LGN4.mat';

afq = AFQ_AddNewFiberGroup_4(afq, fgName, roi1Name, roi2Name, 0, 1);

cd /biac4/wandell/biac3/wandell7/shumpei/matlab/git/LHON/4JMD_5CRD_6LHON_8Ctl_2RP
save 4JMD_5CRD_6LHON_8Ctl_2RP_1206 afq
%% OCF from CC to V1+V2
fgName = 'LOCF_D4L4.pdb';

roi1Name= 'fs_CC.mat';
roi2Name = 'lh_V1_smooth3mm_lh_V2_smooth3mm.mat';
% 
afq = AFQ_AddNewFiberGroup_2(afq, fgName, roi1Name, roi2Name, 0, 1);

%
fgName = 'ROCF_D4L4.pdb';

roi1Name= 'fs_CC.mat';
roi2Name = 'rh_V1_smooth3mm_rh_V2_smooth3mm.mat';

% 3
afq = AFQ_AddNewFiberGroup_2(afq, fgName, roi1Name, roi2Name, 0, 1);

%%
cd /biac4/wandell/biac3/wandell7/shumpei/matlab/git/LHON/4JMD_5CRD_6LHON_8Ctl_2RP
save 4JMD_5CRD_6LHON_8Ctl_2RP_1206 afq
return